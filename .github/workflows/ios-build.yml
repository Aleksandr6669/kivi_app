name: Build iOS App

on:
  workflow_dispatch:  # Это позволяет запускать билд вручную через GitHub Actions UI

jobs:
  build:
    runs-on: macos-latest   # Убедись, что у тебя macOS runner

    steps:
      # Шаг 1: Клонируем репозиторий
      - name: Checkout repository
        uses: actions/checkout@v2

      # Шаг 2: Устанавливаем зависимости, если они есть
      - name: Install dependencies
        run: |
          sudo gem install cocoapods
          pod install

      # Шаг 3: Проверяем, что файл ExportOptions.plist существует
      - name: Check ExportOptions.plist
        run: ls -la ExportOptions.plist

      # Шаг 4: Собираем проект и создаем архив .xcarchive
      - name: Build and Archive iOS App
        run: |
          xcodebuild -workspace YourProject.xcworkspace \
            -scheme YourScheme \
            -sdk iphoneos \
            -configuration Release \
            -archivePath build/ios/YourApp.xcarchive \
            archive

      # Шаг 5: Экспортируем .ipa файл
      - name: Export IPA file
        run: |
          xcodebuild -exportArchive \
            -archivePath "build/ios/YourApp.xcarchive" \
            -exportPath "build/ios/" \
            -exportOptionsPlist ExportOptions.plist

      # Шаг 6: Загружаем .ipa файл как артефакт
      - name: Upload IPA as artifact
        uses: actions/upload-artifact@v3
        with:
          name: ios-app-ipa
          path: build/ios/*.ipa